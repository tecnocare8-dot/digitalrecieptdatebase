# Google Cloud Platform (GCP) 設定ガイド

本アプリで「Googleログイン」を行い、**ユーザー自身のGoogle Driveにファイルを保存**するための設定手順です。
[Google Cloud Console](https://console.cloud.google.com/) にアクセスして作業を行います。

## 1. プロジェクトの作成
1.  画面左上のロゴの横にある「プロジェクトの選択」（または既存のプロジェクト名）をクリック。
2.  右上の「**新しいプロジェクト**」をクリック。
3.  プロジェクト名に `Digital-receipt-database` (など任意の名前) を入力。
4.  「**作成**」をクリック。
5.  作成完了の通知が出たら、「**プロジェクトを選択**」をクリックして切り替えます。

## 2. Google Drive API の有効化
1.  左上のハンバーガーメニュー (≡) > 「**API とサービス**」 > 「**ライブラリ**」を選択。
2.  検索バーに `Google Drive API` と入力して検索。
3.  「**Google Drive API**」を選択し、「**有効にする**」をクリック。

## 3. OAuth 同意画面の設定
1.  左メニューの「**OAuth 同意画面**」を選択。
2.  User Type で「**外部 (External)**」を選択し、「**作成**」をクリック。
3.  **アプリ情報**を入力:
    *   アプリ名: `Digital receipt database`
    *   ユーザーサポートメール: (あなたのアドレス)
    *   デベロッパーの連絡先情報: (あなたのアドレス)
    *   その他は空欄でOK。「保存して次へ」。
4.  **スコープ**の設定 (**重要**):
    *   「**スコープを追加または削除**」をクリック。
    *   フィルタに `auth/drive.file` と入力して検索。
    *   `.../auth/drive.file` (**Google ドライブ上の、このアプリが開いたファイルまたは作成したファイルの表示、管理**) にチェックを入れる。
        *   ※ これにより、アプリが作成したレシート画像のみを管理できるようになります（ユーザーの全てのファイルは見えません）。
    *   同じく `.../auth/userinfo.email` と `.../auth/userinfo.profile` にもチェックが入っていることを確認。
    *   「更新」→「保存して次へ」。
5.  **テストユーザー**の設定:
    *   「**ADD USERS**」をクリック。
    *   **あなたのGoogleメールアドレス** を入力して追加（これがないとテスト中にログインできません）。
    *   「保存して次へ」→ 概要を確認して「ダッシュボードに戻る」。

## 4. 認証情報の作成 (OAuth クライアントID)
1.  左メニューの「**認証情報**」を選択。
2.  上部の「**+ 認証情報を作成**」 > 「**OAuth クライアント ID**」を選択。
3.  **アプリケーションの種類**:
    *   「**ウェブ アプリケーション**」を選択。
    *   名前: `Next.js Client` (など)
4.  **承認済みのリダイレクト URI**:
    *   「**URI を追加**」をクリック。
    *   以下のURLを入力します（開発環境用）。
        *   `http://localhost:3000/api/auth/callback/google`
5.  「**作成**」をクリック。
6.  画面に表示される **クライアント ID** と **クライアント シークレット** をコピーして保管します。

---

## 5. 環境変数の設定
取得した情報を `.env.local` に記述します。
※ サービスアカウント（JSONキー）は不要です。

```bash
# OAuth (ログイン & Driveアクセス用)
GOOGLE_CLIENT_ID=xxxxx.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX-xxxxx

# NextAuth
NEXTAUTH_SECRET=random_string_here
NEXTAUTH_URL=http://localhost:3000
```
